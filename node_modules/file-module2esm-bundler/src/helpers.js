#!/usr/bin/env node

console.log('嘿嘿嘿');
import { simple } from 'acorn-walk'

// 遍历AST语法树取右值。请参考 https://github.com/estree/estree
export function getRightValue(node, identifier) {
  let values = []
  const result = new Set
  const getRaw = item => (item.value?.raw ?? item.value) && result.add(item.value?.raw || item.value)

  simple(node, {
    VariableDeclarator(node) {
      if (identifier === node.id.name) {     // 变量初始化的值(取声明ui时的字面量)
        values = node.init.elements ?? [node.init]
      }
    },
    CallExpression(node) {
      if (identifier === node.callee?.property?.name) {
        values.push(...node.arguments)      // 函数调用时的参数，取moduleResolver
      }
    },
    AssignmentExpression(node) {
      if (identifier === node.left?.property?.name) {
        values = [node.right]  // 赋值表达式的右值，取__moduleRootPath__
      }
    }
  })
  values.forEach(i => i.quasis ? i.quasis.forEach(getRaw) : getRaw(i))
  return [...result]
}